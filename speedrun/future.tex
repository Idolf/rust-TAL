\chapter{Related Work and Future Work}
\label{chap:future}
\section{Related Work}
\hightodo{Write related work}

\section{Original Goal}

The original title of this project was ``A Rust-like Typed Assembly Language --
Using affine types to avoid garbage collection''.

The goal of this proposed thesis was to design a Typed Assembly Language based
on linear types. Linear types have been tried before in the context of TAL, in
particular in the 2003 paper ``A linearly typed assembly
language''\cite{ltal}. In the conclusion of this paper, the authors state that the approach
has serious drawbacks in particular with regards to sharing.

I thought it interesting to revisit the idea, since the programming language
Rust\cite{rust} have proven that using a linear type system\footnote{Technically
  Rust uses an affine type system, not a linear one. In this particular case the
  differences are minor and mostly related to usability of the language.} for
memory management is not completely impractical. In particular it does permit
several useful forms of sharing. I found the paper ``Patina: A Formalization of
the Rust Programming Language''\cite{patina} by Eric Reed, and after skimming
it, it was my hope that I could use the same techniques in a TAL.

I changed focus during the project for a number of reasons. One reason was that
the original paper falls short of actually proving soundness; the last part of
the paper mainly consists of conjectures. This was, as one could expect, quite
detrimental to my effort use the same technique in a TAL. Ideally I should have
noticed this before settling on a thesis subject.

However the much bigger issue in my thesis turned out to be implementing
variables and substitutions correctly in Agda using De Bruijn indices. The
implementation of substitutions take up about 25\% of my final code-base
(including the utilities not specifically related to TAL). This is after
rewriting that part several times and removing unused lemmas.

I do not think that this is an issue with Agda, but rather I think that De
Bruijn indices could simply be hard to formalize correctly -- at least they were
to me. This seems consistent with the results from ``An Untrusted Verifier for
Typed Assembly Language''\cite{untrusted}. In the results section, the authors
describe how they encountered similar problems, when they used a similar
approach to formalizing a TAL in Coq.

This meant that I used most of my time simply re-implementing known results in a
different framework.

\section{Future Work}
\hightodo{Write future work}
